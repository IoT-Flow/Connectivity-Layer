# =================================================================
# IoTFlow MQTT Access Control List (ACL)
# =================================================================

# Admin user - full access to all topics
user admin
topic readwrite #

# Device pattern-based access control
# Devices can only access their own topics based on their client ID
pattern readwrite iotflow/devices/%c/+
pattern readwrite iotflow/devices/%c/telemetry/+
pattern readwrite iotflow/devices/%c/commands/+
pattern readwrite iotflow/devices/%c/status/+
pattern read iotflow/devices/%c/config/+

# System topics - admin only
topic read iotflow/system/+
user admin
topic readwrite iotflow/system/+

# Fleet management topics - admin only
user admin
topic readwrite iotflow/fleet/+
topic readwrite iotflow/fleet/commands/+
topic readwrite iotflow/fleet/status/+

# Device discovery and registration
pattern write iotflow/discovery/register/%c
pattern read iotflow/discovery/response/%c

# Telemetry aggregation topics
pattern read iotflow/telemetry/+/+
user admin
topic readwrite iotflow/telemetry/+/+

# Command topics for specific device types
pattern read iotflow/commands/device-type/+/%c
user admin
topic write iotflow/commands/device-type/+/+

# Status and heartbeat topics
pattern write iotflow/status/devices/%c/heartbeat
pattern write iotflow/status/devices/%c/online
pattern write iotflow/status/devices/%c/offline

# Monitoring and metrics (admin only)
user admin
topic readwrite iotflow/monitoring/+
topic readwrite iotflow/metrics/+
topic readwrite iotflow/alerts/+

# Last will and testament topics
pattern write iotflow/lwt/devices/%c

# Deny access to sensitive system topics for regular devices
topic deny iotflow/admin/+
topic deny iotflow/config/+
topic deny iotflow/security/+
